{% extends "adoptions/plantilla.html" %}
{% block contenido %}

<div class="container mt-5 mb-5">
  <div class="card shadow-lg rounded-4">
    <div class="card-header bg-success text-white text-center fw-bold">
      <i class="bi bi-paw"></i> Editar Publicación de Mascota
    </div>
    <div class="card-body p-4">

      <form id="frm_mascota" action="/processEditPublication/" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <input type="hidden" name="id" id="id" value="{{ pet.id }}">


        <label class="mt-3 fw-semibold">Imágenes actuales:</label>
        <div class="d-flex flex-wrap gap-2 mb-3">
          {% for foto in fotos %}
            <img src="{{ foto.image_path.url }}" style="width: 100px; height: 100px; object-fit: cover;" class="border rounded">
          {% empty %}
            <p class="text-muted">No hay imágenes registradas para esta mascota.</p>
          {% endfor %}
        </div>

        <!-- Agregar nuevas imágenes -->
        <div class="mb-4">
          <label for="image_path" class="form-label fw-semibold">Agregar nuevas imágenes (opcional)</label>
          <input id="image_path" name="image_path[]" type="file" accept="image/*" class="form-control" multiple>
          <div class="form-text">Puede subir hasta 5 imágenes en formato JPG o PNG.</div>
        </div>

        

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="name" class="form-label fw-bold">Nombre de la mascota</label>
            <input type="text" name="name" id="name" class="form-control" placeholder="Ej. Luna, Max, Toby" value="{{pet.name}}" required>
          </div>

          <div class="col-md-6 mb-3">
            <label for="species" class="form-label fw-bold">Tipo de mascota</label>
            <select name="species" id="species" class="form-select" required>
              <option value="">-- Seleccione una opción --</option>
             <option value="feline" {% if pet.species == 'feline' %}selected{% endif %}>Felino</option>
          <option value="canine" {% if pet.species == 'canine' %}selected{% endif %}>Canino</option>
            </select>
          </div>

        </div>

        <div class="row">


          <div class="col-md-6 mb-3">
              <label for="breed" class="form-label fw-bold">Raza</label>
              <select name="breed" id="breed" class="form-select" required>
                <option value="">-- Seleccione una opción --</option>
                <!-- Razas de perros -->
                <option class="canine" value="labrador" {% if pet.breed == "labrador" %}selected{% endif %}>Labrador</option>
                <option class="canine" value="golden_retriever" {% if pet.breed == "golden_retriever" %}selected{% endif %}>Golden Retriever</option>
                <option class="canine" value="german_shepherd" {% if pet.breed == "german_shepherd" %}selected{% endif %}>Pastor Alemán</option>
                <option class="canine" value="bulldog" {% if pet.breed == "bulldog" %}selected{% endif %}>Bulldog</option>
                <option class="canine" value="beagle" {% if pet.breed == "beagle" %}selected{% endif %}>Beagle</option>

                <!-- Razas de gatos -->
                <option class="feline" value="persian" {% if pet.breed == "persian" %}selected{% endif %}>Persa</option>
                <option class="feline" value="siamese" {% if pet.breed == "siamese" %}selected{% endif %}>Siamés</option>
                <option class="feline" value="maine_coon" {% if pet.breed == "maine_coon" %}selected{% endif %}>Maine Coon</option>
                <option class="feline" value="ragdoll" {% if pet.breed == "ragdoll" %}selected{% endif %}>Ragdoll</option>
                <option class="feline" value="sphynx" {% if pet.breed == "sphynx" %}selected{% endif %}>Sphynx</option>
              </select>
            </div>



          <div class="col-md-6 mb-3">
            <label for="age" class="form-label fw-bold">Edad</label>
            <input  name="age" id="age" class="form-control" value="{{pet.age}}" placeholder="Ej. 2 (solo valores numericos que representen la edad)">
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="gender" class="form-label fw-bold">Sexo de la mascota</label>
            <select name="gender" id="gender" class="form-select" required>
              <option value="">-- Seleccione una opción --</option>
          <option value="masculine" {% if pet.gender == 'masculine' %}selected{% endif %}>Macho</option>
          <option value="feminine" {% if pet.gender == 'feminine' %}selected{% endif %}>Hembra</option>
            </select>
          </div>


            <div class="col-md-6 mb-3">
              <label for="color" class="form-label fw-bold">Color</label>
              <select name="color" id="color" class="form-select" required>
                  <option value="">-- Seleccione una opción --</option>
                  <option value="white" {% if pet.color == 'white' %}selected{% endif %}>Blanco</option>
                  <option value="black" {% if pet.color == 'black' %}selected{% endif %}>Negro</option>
                  <option value="brown" {% if pet.color == 'brown' %}selected{% endif %}>Marrón</option>
                  <option value="gray" {% if pet.color == 'gray' %}selected{% endif %}>Gris</option>
                  <option value="golden" {% if pet.color == 'golden' %}selected{% endif %}>Dorado</option>
                  <option value="mixed" {% if pet.color == 'mixed' %}selected{% endif %}>Mezcla</option>
              </select>



            </div>


        </div>

        <div class="mb-3">
          <label for="description" class="form-label fw-bold">Descripción</label>
          <textarea name="description" id="description" rows="3" class="form-control" placeholder="Ej. Muy juguetón, se lleva bien con niños">{{ pet.description }}</textarea>


        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-success px-4 me-2">
            <i class="bi bi-check-circle"></i> Actualizar
          </button>
          <a href="/" class="btn btn-danger px-4">
            <i class="bi bi-x-circle"></i> Cancelar
          </a>
        </div>

      </form>
    </div>
  </div>
</div>


<!-- Script FileInput -->
<script>
  $("#image_path").fileinput({
    language: "es",
    allowedFileExtensions: ["jpg", "jpeg", "png"],
    showCaption: false,
    dropZoneEnabled: true,
    showClose: false,
    maxFileCount: 5,
    browseClass: "btn btn-primary",
    msgPlaceholder: "Selecciona hasta 5 imágenes..."
  });
</script>

<script>
  $("#frm_mascota").validate({
    rules: {
      
      name: {
        required: true,
        minlength: 5,
        maxlength: 50
      },
      species: {
        required: true
      },
      breed: {
        required: true,
       
      },
      gender: {
        required: true
      },
      age: {
        required: true,
        digits: true,
        min: 1,
        max: 20
      },
      color: {
        required: true,
     
      },
      description: {
        required: true,
        minlength: 10,
        maxlength: 500
      }
    },
    messages: {
      
      name: {
        required: "Ingrese el nombre de la mascota",
        minlength: "Debe tener al menos 5 caracteres",
        maxlength: "No debe exceder los 50 caracteres"
      },
      species: {
        required: "Seleccione el tipo de mascota"
      },
      breed: {
        required: "Seleccione la raza de la mascota",
 
      },
      gender: {
        required: "Seleccione el género"
      },
      age: {
        required: "Ingrese la edad aproximada de la mascota",
        digits: "Solo se permiten números enteros",
        min: "La edad mínima es 1",
        max: "La edad máxima es 20"
      },
      color: {
        required: "Seleccione el color de la mascota",

      },
      description: {
        required: "Ingrese una breve descripción",
        minlength: "Debe tener al menos 10 caracteres",
        maxlength: "No debe exceder los 500 caracteres"
      }
    }
  });
</script>
<script>
  $(document).ready(function() {
  $('#species').change(function() {
    var species = $(this).val();
    $('#breed option').hide();
    $('#breed option[value=""]').show(); 
    $('#breed option.' + species).show();
    $('#breed').val(''); 
  });
});

</script>



{% endblock %}
