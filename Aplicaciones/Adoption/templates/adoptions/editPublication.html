{% extends "adoptions/plantilla.html" %}
{% block contenido %}

<div class="container mt-4 mb-5">
  <form id="frm_mascota" action="/processEditPublication/" method="post" enctype="multipart/form-data" class="p-4 shadow-lg rounded bg-light">
{% csrf_token %}
    <h4 class="text-center mb-4 text-success fw-bold">
      游 Editar publicaci칩n de mascota
    </h4>

  
    <input type="hidden" name="id" id="id" value="{{pet.id}}">



      <!-- Fotograf칤as actuales -->
<label class="mt-3 fw-semibold">Im치genes actuales:</label>
<div class="d-flex flex-wrap gap-2 mb-3">
  {% for foto in fotos %}
    <img src="{{ foto.image_path.url }}" style="width: 100px; height: 100px; object-fit: cover;" class="border rounded">
  {% empty %}
    <p class="text-muted">No hay im치genes registradas para esta mascota.</p>
  {% endfor %}
</div>


    <!-- Agregar nuevas im치genes -->
    <div class="mb-4">
      <label for="image_path" class="form-label fw-semibold">Agregar nuevas im치genes (opcional)</label>
      <input id="image_path" name="image_path[]" type="file" accept="image/*" class="form-control" multiple>
      <div class="form-text">Puede subir hasta 5 im치genes en formato JPG, PNG o WEBP.</div>
    </div>

    <!-- Datos generales -->
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="name" class="form-label fw-semibold">Nombre de la mascota</label>
        <input type="text" name="name" id="name" value="{{pet.name}}" class="form-control" placeholder="Ej. Luna, Max, Toby">
      </div>

      <div class="col-md-6 mb-3">
        <label for="species" class="form-label fw-semibold">Tipo de mascota</label>
        <select name="species" id="species" class="form-select">
       <option value="">-- Seleccione una opci칩n --</option>
       <option value="feline" {% if pet.species == 'feline' %}selected{% endif %}>Felino</option>
       <option value="canine" {% if pet.species == 'canine' %}selected{% endif %}>Canino</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="breed" class="form-label fw-semibold">Raza</label>
        <input type="text" name="breed" id="breed" value={{pet.breed}} class="form-control" placeholder="Ej. Labrador, Persa">
      </div>

      <div class="col-md-6 mb-3">
        <label for="age" class="form-label fw-semibold">Edad</label>
        <input type="text" name="age" id="age" value={{pet.age}} class="form-control" placeholder="Ej. 2 a침os, 6 meses">
      </div>
    </div>


      <div class="col-md-6 mb-3">
        <label for="gender" class="form-label fw-semibold">Sexo de la mascota</label>
        <select name="gender" id="gender" class="form-select">
       

            <option value="">-- Seleccione una opci칩n --</option>
            <option value="masculine" {% if pet.gender == 'masculine' %}selected{% endif %}>Macho</option>
            <option value="feminine" {% if pet.gender == 'feminine' %}selected{% endif %}>Hembra</option>
        </select>
      </div>
    </div>

  

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="color" class="form-label fw-semibold">Color</label>
        <input type="text" name="color" id="color" value="{{pet.color}}" class="form-control" placeholder="Ej. Blanco, Negro, Marr칩n">
      </div>

      <div class="col-md-6 mb-3">
        <label for="description" class="form-label fw-semibold">Descripci칩n</label>
        <input name="description" id="description" value="{{pet.description}}" rows="3" class="form-control" placeholder="Ej. Muy juguet칩n, se lleva bien con ni침os">
      </div>
    </div>

    <div class="text-center mt-4">
      <button type="submit" class="btn btn-success px-4 me-2">
        <i class="bi bi-check-circle"></i> Actualizar
      </button>
      <a href="/" class="btn btn-danger px-4">
        <i class="bi bi-x-circle"></i> Cancelar
      </a>
    </div>
  </form>
</div>

<!-- Script FileInput -->
<script>
  $("#image_path").fileinput({
    language: "es",
    allowedFileExtensions: ["jpg", "jpeg", "png"],
    showCaption: false,
    dropZoneEnabled: true,
    showClose: false,
    maxFileCount: 5,
    browseClass: "btn btn-primary",
    msgPlaceholder: "Selecciona hasta 5 im치genes..."
  });
</script>

<!-- Script Validaci칩n -->
<script>
  $(document).ready(function () {
    $("#frm_mascota").validate({
      rules: {
        "image_path[]": {
          required: true,
          extension: "jpg|jpeg|png"
        },
        name: {
          required: true,
          minlength: 5,
          maxlength: 50
        },
        species: {
          required: true
        },
        breed: {
          required: true,
          minlength: 2,
          maxlength: 50
        },


        gender: {
          required: true,
        
        },

        age: {
          required: true,
          minlength: 1,
          maxlength: 20
        },
        color: {
          required: true,
          minlength: 5,
          maxlength: 30
        },
        description: {
          required: true,
          minlength: 10,
          maxlength: 500
        }
      },
      messages: {
        "image_path[]": {
          required: "Debe subir al menos una imagen",
          extension: "Solo se permiten archivos JPG, JPEG o PNG"
        },
        name: {
          required: "Ingrese el nombre de la mascota",
          minlength: "Debe tener al menos 5 caracteres",
          maxlength: "No debe exceder los 50 caracteres"
        },
        species: {
          required: "Seleccione el tipo de mascota"
        },
        breed: {
          required: "Ingrese la raza de la mascota",
          minlength: "Debe tener al menos 2 caracteres",
          maxlength: "No debe exceder los 50 caracteres"
        },
        age: {
          required: "Ingrese la edad aproximada de la mascota",
          minlength: "Debe tener al menos 1 car치cter",
          maxlength: "No debe exceder los 20 caracteres"
        },
          gender: {
          required: "Seleccione el genero"
        },
        color: {
          required: "Ingrese el color de la mascota",
          minlength: "Debe tener al menos 5 caracteres",
          maxlength: "No debe exceder los 30 caracteres"
        },
        description: {
          required: "Ingrese una breve descripci칩n",
          minlength: "Debe tener al menos 10 caracteres",
          maxlength: "No debe exceder los 500 caracteres"
        }
      },
          });
  });
</script>

{% endblock %}
