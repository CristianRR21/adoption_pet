{% extends 'administrator/plantilla.html' %}
{% block contenido %}
<div class="container mt-4">


  <div class="row">
    <div class="col-md-3 mb-3">
      <div class="card text-white bg-primary shadow">
        <div class="card-body text-center">
          <h5>Total Usuarios</h5>
          <h3>{{ total_usuarios }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div class="card text-white bg-success shadow">
        <div class="card-body text-center">
          <h5>Mascotas Registradas</h5>
          <h3>{{ total_mascotas }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div class="card text-white bg-warning shadow">
        <div class="card-body text-center">
          <h5>Adopciones Aprobadas</h5>
          <h3>{{ aprobadas }}</h3>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-3">
      <div class="card text-white bg-danger shadow">
        <div class="card-body text-center">
          <h5>Adopciones Rechazadas</h5>
          <h3>{{ rechazadas }}</h3>
        </div>
      </div>
    </div>

     <div class="col-md-3 mb-3">
      <div class="card text-white bg-secondary shadow">
        <div class="card-body text-center">
          <h5>Adopciones Pendientes</h5>
          <h3>{{ pendientes }}</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-4">
      <h5 class="text-center">Usuarios por Rol</h5>
      <canvas id="graficoUsuarios" height="250"></canvas>
    </div>

    <div class="col-md-4">
      <h5 class="text-center">Estado de Mascotas</h5>
      <canvas id="graficoMascotas" height="250"></canvas>
    </div>

    <div class="col-md-4">
      <h5 class="text-center">Estado de Adopciones</h5>
      <canvas id="graficoAdopciones" height="250"></canvas>
    </div>
  </div>
  <br>
  <br>
  <div>
    <h5 style="text-align: center;">Usuarios con más adopciones aprobadas</h5><br>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Total de adopciones</th>
        </tr>
      </thead>
      <tbody>
        {% for u in usuarios_top %}
        <tr>
          <td>{{ u.first_name }}</td>
          <td>{{ u.total_adopciones }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="2">No hay adopciones aprobadas aún.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  const usuarios = JSON.parse('{{ grafico_usuarios_json|escapejs }}');
  new Chart(document.getElementById('graficoUsuarios'), {
    type: 'doughnut',
    data: {
      labels: ['Adoptantes', 'Dueños'],
      datasets: [{
        data: usuarios,
        backgroundColor: ['#2ecc71', '#3498db']
      }]
    }
  });

  const mascotas = JSON.parse('{{ grafico_mascotas_json|escapejs }}');
  new Chart(document.getElementById('graficoMascotas'), {
    type: 'pie',
    data: {
      labels: ['Disponibles', 'Adoptadas'],
      datasets: [{
        data: mascotas,
        backgroundColor: ['#1abc9c', '#e74c3c']
      }]
    }
  });

  const adopciones = JSON.parse('{{ grafico_adopciones_json|escapejs }}');
  new Chart(document.getElementById('graficoAdopciones'), {
    type: 'bar',
    data: {
      labels: ['Pendientes', 'Aprobadas', 'Rechazadas'],
      datasets: [{
        label: 'Adopciones',
        data: adopciones,
        backgroundColor: ['#f39c12', '#2ecc71', '#e74c3c']
      }]
    },
    options: { scales: { y: { beginAtZero: true } } }
  });
</script>

{% endblock %}


